var F=Object.defineProperty;var j=(a,t,e)=>t in a?F(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var c=(a,t,e)=>(j(a,typeof t!="symbol"?t+"":t,e),e),B=(a,t,e)=>{if(!t.has(a))throw TypeError("Cannot "+e)};var s=(a,t,e)=>(B(a,t,"read from private field"),e?e.call(a):t.get(a)),h=(a,t,e)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,e)},O=(a,t,e,o)=>(B(a,t,"write to private field"),o?o.call(a,e):t.set(a,e),e);import{d as M}from"./download-CUL7qoee.js";import{aF as V,aQ as G,r as A,aR as $,aH as S,aI as C,c as U,n as k,aS as X,aJ as x,aT as H,aM as Y,aN as P,aU as z,aO as K,aV as J}from"./index-Bkwvj8yD.js";var r;(function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.FFPROBE="FFPROBE",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT"})(r||(r={}));const Q=(()=>{let a=0;return()=>a++})(),Z=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),q=new Error("called FFmpeg.terminate()");var u,p,R,w,m,L,d;class tt{constructor(){h(this,u,null);h(this,p,{});h(this,R,{});h(this,w,[]);h(this,m,[]);c(this,"loaded",!1);h(this,L,()=>{s(this,u)&&(s(this,u).onmessage=({data:{id:t,type:e,data:o}})=>{switch(e){case r.LOAD:this.loaded=!0,s(this,p)[t](o);break;case r.MOUNT:case r.UNMOUNT:case r.EXEC:case r.FFPROBE:case r.WRITE_FILE:case r.READ_FILE:case r.DELETE_FILE:case r.RENAME:case r.CREATE_DIR:case r.LIST_DIR:case r.DELETE_DIR:s(this,p)[t](o);break;case r.LOG:s(this,w).forEach(n=>n(o));break;case r.PROGRESS:s(this,m).forEach(n=>n(o));break;case r.ERROR:s(this,R)[t](o);break}delete s(this,p)[t],delete s(this,R)[t]})});h(this,d,({type:t,data:e},o=[],n)=>s(this,u)?new Promise((i,l)=>{const f=Q();s(this,u)&&s(this,u).postMessage({id:f,type:t,data:e},o),s(this,p)[f]=i,s(this,R)[f]=l,n==null||n.addEventListener("abort",()=>{l(new DOMException(`Message # ${f} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Z));c(this,"load",({classWorkerURL:t,...e}={},{signal:o}={})=>(s(this,u)||(O(this,u,t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),s(this,L).call(this)),s(this,d).call(this,{type:r.LOAD,data:e},void 0,o)));c(this,"exec",(t,e=-1,{signal:o}={})=>s(this,d).call(this,{type:r.EXEC,data:{args:t,timeout:e}},void 0,o));c(this,"ffprobe",(t,e=-1,{signal:o}={})=>s(this,d).call(this,{type:r.FFPROBE,data:{args:t,timeout:e}},void 0,o));c(this,"terminate",()=>{const t=Object.keys(s(this,R));for(const e of t)s(this,R)[e](q),delete s(this,R)[e],delete s(this,p)[e];s(this,u)&&(s(this,u).terminate(),O(this,u,null),this.loaded=!1)});c(this,"writeFile",(t,e,{signal:o}={})=>{const n=[];return e instanceof Uint8Array&&n.push(e.buffer),s(this,d).call(this,{type:r.WRITE_FILE,data:{path:t,data:e}},n,o)});c(this,"mount",(t,e,o)=>{const n=[];return s(this,d).call(this,{type:r.MOUNT,data:{fsType:t,options:e,mountPoint:o}},n)});c(this,"unmount",t=>{const e=[];return s(this,d).call(this,{type:r.UNMOUNT,data:{mountPoint:t}},e)});c(this,"readFile",(t,e="binary",{signal:o}={})=>s(this,d).call(this,{type:r.READ_FILE,data:{path:t,encoding:e}},void 0,o));c(this,"deleteFile",(t,{signal:e}={})=>s(this,d).call(this,{type:r.DELETE_FILE,data:{path:t}},void 0,e));c(this,"rename",(t,e,{signal:o}={})=>s(this,d).call(this,{type:r.RENAME,data:{oldPath:t,newPath:e}},void 0,o));c(this,"createDir",(t,{signal:e}={})=>s(this,d).call(this,{type:r.CREATE_DIR,data:{path:t}},void 0,e));c(this,"listDir",(t,{signal:e}={})=>s(this,d).call(this,{type:r.LIST_DIR,data:{path:t}},void 0,e));c(this,"deleteDir",(t,{signal:e}={})=>s(this,d).call(this,{type:r.DELETE_DIR,data:{path:t}},void 0,e))}on(t,e){t==="log"?s(this,w).push(e):t==="progress"&&s(this,m).push(e)}off(t,e){t==="log"?O(this,w,s(this,w).filter(o=>o!==e)):t==="progress"&&O(this,m,s(this,m).filter(o=>o!==e))}}u=new WeakMap,p=new WeakMap,R=new WeakMap,w=new WeakMap,m=new WeakMap,L=new WeakMap,d=new WeakMap;var T;(function(a){a.MEMFS="MEMFS",a.NODEFS="NODEFS",a.NODERAWFS="NODERAWFS",a.IDBFS="IDBFS",a.WORKERFS="WORKERFS",a.PROXYFS="PROXYFS"})(T||(T={}));const et=new Error("failed to get response body reader"),at=new Error("failed to complete download"),ot="Content-Length",st=a=>new Promise((t,e)=>{const o=new FileReader;o.onload=()=>{const{result:n}=o;n instanceof ArrayBuffer?t(new Uint8Array(n)):t(new Uint8Array)},o.onerror=n=>{var i,l;e(Error(`File could not be read! Code=${((l=(i=n==null?void 0:n.target)==null?void 0:i.error)==null?void 0:l.code)||-1}`))},o.readAsArrayBuffer(a)}),nt=async a=>{let t;if(typeof a=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(a)?t=atob(a.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(a)).arrayBuffer();else if(a instanceof URL)t=await(await fetch(a)).arrayBuffer();else if(a instanceof File||a instanceof Blob)t=await st(a);else return new Uint8Array;return new Uint8Array(t)},rt=async(a,t)=>{var n;const e=await fetch(a);let o;try{const i=parseInt(e.headers.get(ot)||"-1"),l=(n=e.body)==null?void 0:n.getReader();if(!l)throw et;const f=[];let E=0;for(;;){const{done:_,value:I}=await l.read(),b=I?I.length:0;if(_){if(i!=-1&&i!==E)throw at;t&&t({url:a,total:i,received:E,delta:b,done:_});break}f.push(I),E+=b,t&&t({url:a,total:i,received:E,delta:b,done:_})}const y=new Uint8Array(E);let v=0;for(const _ of f)y.set(_,v),v+=_.length;o=y.buffer}catch(i){console.log("failed to send download progress event: ",i),o=await e.arrayBuffer()}return o},N=async(a,t,e=!1,o)=>{const n=e?await rt(a,o):await(await fetch(a)).arrayBuffer(),i=new Blob([n],{type:t});return URL.createObjectURL(i)},g="https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm",D=new tt,it=ct();async function ct(){return D.load({coreURL:await N(`${g}/ffmpeg-core.js`,"text/javascript"),wasmURL:await N(`${g}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await N(`${g}/ffmpeg-core.worker.js`,"text/javascript")})}async function dt(a,t="output.mp4",e){{const o=await ft(a);return lt(o,t)}}async function lt(a,t="output.mp4"){const e=[];for(const[n,i]of a.entries()){const l=`${n}.ts`;D.writeFile(l,await nt(i)),e.push(`file ${l}`)}return await D.writeFile("concat_list.txt",e.join(`
`)),await D.exec(["-f","concat","-safe","0","-i","concat_list.txt","-c","copy",t]),await D.readFile(t)}async function ft(a){const t=a.substring(0,a.lastIndexOf("/")+1);return(await(await fetch(a)).text()).split(`
`).map(i=>i.startsWith("#")||i.trim()===""?"":i.startsWith("http")?i:t+i).filter(Boolean)}const ut={class:"px-4 pt-4"},Et={class:"flex justify-between items-center"},Rt={class:"w-8/12"},ht=["src"],pt=V({__name:"MDContent",setup(a){const{t}=G({inheritLocale:!0,useScope:"local"}),e=A(""),o=A(""),n=A("");async function i(){e.value="Loading ffmpeg-core.js",D.on("log",({message:E})=>{e.value=E}),await it,e.value="Start transcoding";const l=await dt(n.value,"output.mp4");e.value="Complete transcoding";const f=new Blob([l.buffer],{type:"video/mp4"});o.value=URL.createObjectURL(f),e.value="Downloading",M(f,{filename:"output.mp4"}),e.value="Download complete"}return $(()=>{window.URL.revokeObjectURL(o.value)}),(l,f)=>(P(),S("div",ut,[C("div",Et,[C("div",Rt,[U(X,{modelValue:n.value,"onUpdate:modelValue":f[0]||(f[0]=E=>n.value=E),placeholder:k(t)("download_placeholder"),messages:e.value},null,8,["modelValue","placeholder","messages"])]),U(H,{variant:"outlined",divided:""},{default:x(()=>[U(z,{onClick:i},{default:x(()=>[K(J(k(t)("download")),1)]),_:1})]),_:1})]),o.value?(P(),S("video",{key:0,class:"pt-2",src:o.value,controls:""},null,8,ht)):Y("",!0)]))}});function W(a){const t=a;t.__i18n=t.__i18n||[],t.__i18n.push({locale:"",resource:{en:{download:{t:0,b:{t:2,i:[{t:3}],s:"Download"}},download_placeholder:{t:0,b:{t:2,i:[{t:3}],s:"Please enter the playback address"}}},zhHans:{download:{t:0,b:{t:2,i:[{t:3}],s:"下载"}},download_placeholder:{t:0,b:{t:2,i:[{t:3}],s:"请输入播放地址"}}}}})}typeof W=="function"&&W(pt);export{pt as default};
