var v=Object.defineProperty;var S=(a,e,t)=>e in a?v(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>(S(a,typeof e!="symbol"?e+"":e,t),t),B=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var o=(a,e,t)=>(B(a,e,"read from private field"),t?t.call(a):e.get(a)),R=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},L=(a,e,t,s)=>(B(a,e,"write to private field"),s?s.call(a,t):e.set(a,t),t);import{aF as P,aQ as x,r as b,aH as j,aI as F,c as A,n as C,aR as W,aJ as k,aS as G,aN as V,aT as M,aO as $,aU as H}from"./index-B8yupdKK.js";var r;(function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.FFPROBE="FFPROBE",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT"})(r||(r={}));const X=(()=>{let a=0;return()=>a++})(),z=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),J=new Error("called FFmpeg.terminate()");var l,p,h,w,_,D,d;class K{constructor(){R(this,l,null);R(this,p,{});R(this,h,{});R(this,w,[]);R(this,_,[]);c(this,"loaded",!1);R(this,D,()=>{o(this,l)&&(o(this,l).onmessage=({data:{id:e,type:t,data:s}})=>{switch(t){case r.LOAD:this.loaded=!0,o(this,p)[e](s);break;case r.MOUNT:case r.UNMOUNT:case r.EXEC:case r.FFPROBE:case r.WRITE_FILE:case r.READ_FILE:case r.DELETE_FILE:case r.RENAME:case r.CREATE_DIR:case r.LIST_DIR:case r.DELETE_DIR:o(this,p)[e](s);break;case r.LOG:o(this,w).forEach(n=>n(s));break;case r.PROGRESS:o(this,_).forEach(n=>n(s));break;case r.ERROR:o(this,h)[e](s);break}delete o(this,p)[e],delete o(this,h)[e]})});R(this,d,({type:e,data:t},s=[],n)=>o(this,l)?new Promise((i,E)=>{const f=X();o(this,l)&&o(this,l).postMessage({id:f,type:e,data:t},s),o(this,p)[f]=i,o(this,h)[f]=E,n==null||n.addEventListener("abort",()=>{E(new DOMException(`Message # ${f} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(z));c(this,"load",({classWorkerURL:e,...t}={},{signal:s}={})=>(o(this,l)||(L(this,l,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/knives/assets/worker-CJKE1Low.js",import.meta.url),{type:"module"})),o(this,D).call(this)),o(this,d).call(this,{type:r.LOAD,data:t},void 0,s)));c(this,"exec",(e,t=-1,{signal:s}={})=>o(this,d).call(this,{type:r.EXEC,data:{args:e,timeout:t}},void 0,s));c(this,"ffprobe",(e,t=-1,{signal:s}={})=>o(this,d).call(this,{type:r.FFPROBE,data:{args:e,timeout:t}},void 0,s));c(this,"terminate",()=>{const e=Object.keys(o(this,h));for(const t of e)o(this,h)[t](J),delete o(this,h)[t],delete o(this,p)[t];o(this,l)&&(o(this,l).terminate(),L(this,l,null),this.loaded=!1)});c(this,"writeFile",(e,t,{signal:s}={})=>{const n=[];return t instanceof Uint8Array&&n.push(t.buffer),o(this,d).call(this,{type:r.WRITE_FILE,data:{path:e,data:t}},n,s)});c(this,"mount",(e,t,s)=>{const n=[];return o(this,d).call(this,{type:r.MOUNT,data:{fsType:e,options:t,mountPoint:s}},n)});c(this,"unmount",e=>{const t=[];return o(this,d).call(this,{type:r.UNMOUNT,data:{mountPoint:e}},t)});c(this,"readFile",(e,t="binary",{signal:s}={})=>o(this,d).call(this,{type:r.READ_FILE,data:{path:e,encoding:t}},void 0,s));c(this,"deleteFile",(e,{signal:t}={})=>o(this,d).call(this,{type:r.DELETE_FILE,data:{path:e}},void 0,t));c(this,"rename",(e,t,{signal:s}={})=>o(this,d).call(this,{type:r.RENAME,data:{oldPath:e,newPath:t}},void 0,s));c(this,"createDir",(e,{signal:t}={})=>o(this,d).call(this,{type:r.CREATE_DIR,data:{path:e}},void 0,t));c(this,"listDir",(e,{signal:t}={})=>o(this,d).call(this,{type:r.LIST_DIR,data:{path:e}},void 0,t));c(this,"deleteDir",(e,{signal:t}={})=>o(this,d).call(this,{type:r.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?o(this,w).push(t):e==="progress"&&o(this,_).push(t)}off(e,t){e==="log"?L(this,w,o(this,w).filter(s=>s!==t)):e==="progress"&&L(this,_,o(this,_).filter(s=>s!==t))}}l=new WeakMap,p=new WeakMap,h=new WeakMap,w=new WeakMap,_=new WeakMap,D=new WeakMap,d=new WeakMap;const Q=new Error("failed to get response body reader"),Y=new Error("failed to complete download"),Z="Content-Length",q=a=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const{result:n}=s;n instanceof ArrayBuffer?e(new Uint8Array(n)):e(new Uint8Array)},s.onerror=n=>{var i,E;t(Error(`File could not be read! Code=${((E=(i=n==null?void 0:n.target)==null?void 0:i.error)==null?void 0:E.code)||-1}`))},s.readAsArrayBuffer(a)}),ee=async a=>{let e;if(typeof a=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(a)?e=atob(a.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(a)).arrayBuffer();else if(a instanceof URL)e=await(await fetch(a)).arrayBuffer();else if(a instanceof File||a instanceof Blob)e=await q(a);else return new Uint8Array;return new Uint8Array(e)},te=async(a,e)=>{var n;const t=await fetch(a);let s;try{const i=parseInt(t.headers.get(Z)||"-1"),E=(n=t.body)==null?void 0:n.getReader();if(!E)throw Q;const f=[];let u=0;for(;;){const{done:m,value:O}=await E.read(),I=O?O.length:0;if(m){if(i!=-1&&i!==u)throw Y;e&&e({url:a,total:i,received:u,delta:I,done:m});break}f.push(O),u+=I,e&&e({url:a,total:i,received:u,delta:I,done:m})}const g=new Uint8Array(u);let N=0;for(const m of f)g.set(m,N),N+=m.length;s=g.buffer}catch(i){console.log("failed to send download progress event: ",i),s=await t.arrayBuffer()}return s},U=async(a,e,t=!1,s)=>{const n=t?await te(a,s):await(await fetch(a)).arrayBuffer(),i=new Blob([n],{type:e});return URL.createObjectURL(i)},y="https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm",ae={class:"flex justify-between items-center px-4 pt-4"},se={class:"w-8/12"},oe=P({__name:"MDContent",setup(a){const e=new K,{t}=x({inheritLocale:!0,useScope:"local"}),s=b(""),n=b(""),i=b("");async function E(){s.value="Loading ffmpeg-core.js",e.on("log",({message:u})=>{s.value=u}),await e.load({coreURL:await U(`${y}/ffmpeg-core.js`,"text/javascript"),wasmURL:await U(`${y}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await U(`${y}/ffmpeg-core.worker.js`,"text/javascript")}),s.value="Start transcoding",await e.writeFile("input.m3u8",await ee(i.value)),await e.exec(["-protocol_whitelist","file,http,https,tcp,tls,crypto","-i","input.m3u8","-c","copy","-bsf:a","aac_adtstoasc","test.mp4"]),s.value="Complete transcoding";const f=await e.readFile("test.mp4");n.value=URL.createObjectURL(new Blob([f.buffer],{type:"video/mp4"}))}return(f,u)=>(V(),j("div",ae,[F("div",se,[A(W,{placeholder:C(t)("download_placeholder"),messages:s.value},null,8,["placeholder","messages"])]),A(G,{variant:"outlined",divided:""},{default:k(()=>[A(M,{onClick:E},{default:k(()=>[$(H(C(t)("download")),1)]),_:1})]),_:1})]))}});function T(a){const e=a;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{download:{t:0,b:{t:2,i:[{t:3}],s:"Download"}},download_placeholder:{t:0,b:{t:2,i:[{t:3}],s:"Please enter the playback address"}}},zhHans:{download:{t:0,b:{t:2,i:[{t:3}],s:"下载"}},download_placeholder:{t:0,b:{t:2,i:[{t:3}],s:"请输入播放地址"}}}}})}typeof T=="function"&&T(oe);export{oe as default};
